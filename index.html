<!doctype html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: system-ui;
      margin: 0;
      padding: 28px;
      background: #111;
      color: #fff;
    }
    .big { font-size: 64px; font-weight: 700; }
    .mid { font-size: 34px; margin-top: 18px; }
    .small { font-size: 20px; margin-top: 14px; opacity: 0.7; }
    .danger { background: #7a0000; }
  </style>
</head>

<body id="b">
  <div class="big" id="next">Loading‚Ä¶</div>
  <div class="mid" id="leave"></div>
  <div class="mid" id="arrive"></div>
  <div class="small" id="meta"></div>

  <script>
    const ENDPOINT = "https://script.google.com/macros/s/AKfycbxK0bOe9JwfNTsfQXaq9YpMs7Oe3y8-xBQylSYL1-kwlHs48lV1VNHVcBU5r9Fo_zpDSw/exec";

    async function load() {
      const res = await fetch(ENDPOINT, { cache: "no-store" });
      const d = await res.json();

      if (!d.ok) {
        document.getElementById("next").innerText = "No trip found";
        document.getElementById("leave").innerText = d.message || "";
        document.getElementById("arrive").innerText = "";
        return;
      }

      document.getElementById("next").innerText =
        `üöå 410 departs ${d.departsAt} (${d.minsToDepart}m)`;

      document.getElementById("leave").innerText =
        `‚è∞ Leave by ${d.leaveBy} (${d.minsToLeave}m)`;

      document.getElementById("arrive").innerText =
        `‚úÖ Arrive by ${d.arriveBy}`;

      document.getElementById("meta").innerText =
        `Updated ${new Date(d.updatedAt).toLocaleTimeString()}`;

      document.getElementById("b").className =
        (d.minsToLeave <= 0) ? "danger" : "";
    }

    load();
    setInterval(load, 15000);
  </script>
</body>
</html>
